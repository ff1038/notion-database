<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Database Display</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .database-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .database-header {
            background: #2e3440;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .database-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #d73a49;
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            margin: 20px;
        }
        
        .database-grid {
            display: grid;
            gap: 16px;
            padding: 20px;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }
        
        .database-item {
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            padding: 16px;
            background: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .database-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .item-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0 0 12px 0;
            color: #1a1a1a;
        }
        
        .item-properties {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .property {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
        }
        
        .property-name {
            font-weight: 500;
            color: #666;
            font-size: 14px;
        }
        
        .property-value {
            color: #1a1a1a;
            font-size: 14px;
        }
        
        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            display: inline-block;
            margin: 2px;
        }
        
        .status {
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status.not-started { background: #f5f5f5; color: #666; }
        .status.in-progress { background: #fff3cd; color: #856404; }
        .status.completed { background: #d4edda; color: #155724; }
        
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2e3440;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            font-size: 20px;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: #3b4252;
        }
        
        .config-panel {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .config-panel h3 {
            margin-top: 0;
            color: #856404;
        }
        
        .config-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 8px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="config-panel">
        <h3>⚠️ Configuration Required</h3>
        <p>To use this, you'll need to:</p>
        <ol>
            <li>Get your Notion integration token from <a href="https://www.notion.so/my-integrations" target="_blank">notion.so/my-integrations</a></li>
            <li>Share your database with the integration</li>
            <li>Enter your credentials below</li>
        </ol>
        <input type="password" id="token" class="config-input" placeholder="Notion Integration Token (secret_...)">
        <input type="text" id="databaseId" class="config-input" placeholder="Database ID (32 characters)">
        <button onclick="loadDatabase()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Load Database</button>
    </div>

    <div class="database-container">
        <div class="database-header">
            <h1 class="database-title" id="databaseTitle">Notion Database</h1>
        </div>
        
        <div id="content">
            <div class="loading">
                Enter your Notion credentials above to load the database
            </div>
        </div>
    </div>
    
    <button class="refresh-btn" onclick="loadDatabase()" title="Refresh Data">
        ↻
    </button>

    <script>
        let notionToken = '';
        let databaseId = '';

        // Replace this with your actual Vercel URL
        const PROXY_URL = 'https://notion-database-proxy.vercel.app';

        async function loadDatabase() {
            notionToken = document.getElementById('token').value;
            databaseId = document.getElementById('databaseId').value;
            
            if (!notionToken || !databaseId) {
                showError('Please enter both Notion token and database ID');
                return;
            }

            const content = document.getElementById('content');
            content.innerHTML = '<div class="loading">Loading database...</div>';

            try {
                // Use your Vercel proxy
                const response = await fetch(`${PROXY_URL}/api/notion?databaseId=${databaseId}&token=${notionToken}`);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                displayDatabase(data);
                
            } catch (error) {
                showError(`Error loading database: ${error.message}<br><br>
                    <strong>Troubleshooting:</strong><br>
                    1. Make sure your Vercel URL is correct<br>
                    2. Check that your Notion token starts with 'secret_'<br>
                    3. Verify your database ID is 32 characters<br>
                    4. Ensure the database is shared with your integration`);
            }
        }

        function displayDatabase(data) {
            const content = document.getElementById('content');
            
            if (!data.results || data.results.length === 0) {
                content.innerHTML = '<div class="loading">No items found in database</div>';
                return;
            }

            let html = '<div class="database-grid">';
            
            data.results.forEach(page => {
                html += '<div class="database-item">';
                
                // Get title
                const titleProp = Object.values(page.properties).find(prop => prop.type === 'title');
                const title = titleProp ? getPropertyValue(titleProp) : 'Untitled';
                html += `<h3 class="item-title">${title}</h3>`;
                
                // Display other properties
                html += '<div class="item-properties">';
                Object.entries(page.properties).forEach(([name, property]) => {
                    if (property.type !== 'title') {
                        const value = getPropertyValue(property);
                        if (value) {
                            html += `
                                <div class="property">
                                    <span class="property-name">${name}:</span>
                                    <span class="property-value">${value}</span>
                                </div>
                            `;
                        }
                    }
                });
                html += '</div>';
                
                html += '</div>';
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function getPropertyValue(property) {
            switch (property.type) {
                case 'title':
                    return property.title.map(t => t.plain_text).join('');
                case 'rich_text':
                    return property.rich_text.map(t => t.plain_text).join('');
                case 'number':
                    return property.number;
                case 'select':
                    return property.select ? `<span class="tag">${property.select.name}</span>` : '';
                case 'multi_select':
                    return property.multi_select.map(tag => `<span class="tag">${tag.name}</span>`).join('');
                case 'date':
                    return property.date ? new Date(property.date.start).toLocaleDateString() : '';
                case 'checkbox':
                    return property.checkbox ? '✅' : '❌';
                case 'url':
                    return property.url ? `<a href="${property.url}" target="_blank">Link</a>` : '';
                case 'email':
                    return property.email ? `<a href="mailto:${property.email}">${property.email}</a>` : '';
                case 'phone_number':
                    return property.phone_number || '';
                case 'status':
                    if (property.status) {
                        const status = property.status.name.toLowerCase().replace(/\s+/g, '-');
                        return `<span class="status ${status}">${property.status.name}</span>`;
                    }
                    return '';
                default:
                    return '';
            }
        }

        function showError(message) {
            const content = document.getElementById('content');
            content.innerHTML = `<div class="error">${message}</div>`;
        }
    </script>
</body>
</html>
